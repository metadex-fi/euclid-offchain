[0m[32mTask[0m [0m[36mtest[0m deno test --allow-env --allow-read --allow-net tests
[0m[32mCheck[0m file:///Users/ChrisHiatt/Projects/adaswap/vasil_2022Q3/euclid-offchain/tests/emulator.test.ts
[0m[32mCheck[0m file:///Users/ChrisHiatt/Projects/adaswap/vasil_2022Q3/euclid-offchain/tests/types.test.ts
[0m[38;5;245mrunning 1 test from ./tests/emulator.test.ts[0m
emulator ...
[0m[38;5;245m------- output -------[0m
trials left: 1
accounts: 9

trials left: 1 - iteration: 0 - block: 0
virtual: 9000
weight: 1
jumpSize: 39
minAnchorPrice: 8775
jumpLog: 0.025317807984289786
anchorLog: 0.00011395362099964392
222.17642372565678
maxTicks: 1
maxTicks_: 222
1
virtual: 7814
weight: 1
jumpSize: 100
minAnchorPrice: 7736
jumpLog: 0.009950330853168092
anchorLog: 0.00012925741632415974
76.98073453838839
maxTicks: 1
maxTicks_: 76
1
virtual: 4397
weight: 2
jumpSize: 100
minAnchorPrice: 8706
jumpLog: 0.009950330853168092
anchorLog: 0.00011485671637278756
86.63255547784034
maxTicks: 1
maxTicks_: 86
1
Opening pool with 1 dirac utxos and 1 param utxos

trials left: 1 - iteration: 1 - block: 1
virtual: 2
weight: 51
jumpSize: 100
minAnchorPrice: 100
jumpLog: 0.009950330853168092
anchorLog: 0.009950330853168092
1
maxTicks: 4165
maxTicks_: 1
1
virtual: 9000
weight: 1
jumpSize: 83
minAnchorPrice: 8892
jumpLog: 0.01197619104671562
anchorLog: 0.00011245431555278046
106.4982787707653
maxTicks: 4165
maxTicks_: 106
3
Opening pool with 1 dirac utxos and 1 param utxos

trials left: 1 - iteration: 2 - block: 462
Swapping.boundary()
valueEquation: 
        addedBuyingA0  9230 > 
        addedSellingA0 7813
Swapping.boundary()
boughtAssetForSale (new): 
        buyingAmm  5281816 > 
        spotBuying 5281817
valueEquation: 
        addedBuyingA0  90712440 > 
        addedSellingA0 89790889
Swapping.boundary()
[0m[38;5;245m----- output end -----[0m
emulator ... [0m[31mFAILED[0m [0m[38;5;245m(525ms)[0m
[0m[38;5;245mrunning 0 tests from ./tests/types.test.ts[0m

[0m[1m[37m[41m ERRORS [0m

emulator [0m[38;5;245m=> ./tests/emulator.test.ts:15:6[0m
[0m[1m[31merror[0m: AssertionError: selling one less should fail: Swapping (
  paramUtxo: ParamUtxo (
     +  param: Param (
   +     +  owner: 5d6ca14f1619efa1cdde42ac0a61344102d0edd4d71d3cf1ad155c90, 
   +     +  virtual: +[
   +     +  +  8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e_PnzWVC: 2,
   +     +  +  10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab_DsDUu: 9000
   +     +  ], 
   +     +  weights: +[
   +     +  +  8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e_PnzWVC: 51,
   +     +  +  10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab_DsDUu: 1
   +     +  ]
   +     +  jumpSizes: +[
   +     +  +  8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e_PnzWVC: 100,
   +     +  +  10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab_DsDUu: 83
   +     +  ], 
   +     +  active: 1
   +     )
     )
  diracUtxo: DiracUtxo (
     +  dirac: Dirac(
   +     +  owner: 5d6ca14f1619efa1cdde42ac0a61344102d0edd4d71d3cf1ad155c90,
   +     +  threadNFT: IdNFT (Currency(49a0b0e032416036152977ff1fac1aed683512166af02b36f2eb1851), Hash: 16076bd0c3eb6965cf804ca73b829f24d0e75ed838240badfa6701bfa71391d5),
   +     +  paramNFT: IdNFT (Currency(49a0b0e032416036152977ff1fac1aed683512166af02b36f2eb1851), Hash: e902fc7f46f22bf3e75dabc8b0c90e70efd98ae1c5d203a15b7207ab35d7dcfa),
   +     +  anchorPrices: +[
   +     +  +  8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e_PnzWVC: 100,
   +     +  +  10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab_DsDUu: 8892
   +     +  ],
   +     ),
     +  balance: +[
   +  +  _: 2629100,
   +  +  10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab_DsDUu: 9000,
   +  +  8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e_PnzWVC: 4165
   +  ]
     )
  boughtAsset:  Asset(10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab, DsDUu)
  soldAsset:    Asset(8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e, PnzWVC)
  boughtAmount: 3
  soldAmount:   42
  boughtSpot:   17810
  soldSpot:     214673
  (boughtA0:    644019)
  (soldA0:      748020)
  boughtExp:    58
  soldExp:      771
  spotPrice:    12.05350926445817
  eff.Price:    14
  maxBuying:    9000
  (maxBuyingA0: 1932057000)
)
~~~>
Swapping (
  paramUtxo: ParamUtxo (
     +  param: Param (
   +     +  owner: 5d6ca14f1619efa1cdde42ac0a61344102d0edd4d71d3cf1ad155c90, 
   +     +  virtual: +[
   +     +  +  8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e_PnzWVC: 2,
   +     +  +  10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab_DsDUu: 9000
   +     +  ], 
   +     +  weights: +[
   +     +  +  8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e_PnzWVC: 51,
   +     +  +  10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab_DsDUu: 1
   +     +  ]
   +     +  jumpSizes: +[
   +     +  +  8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e_PnzWVC: 100,
   +     +  +  10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab_DsDUu: 83
   +     +  ], 
   +     +  active: 1
   +     )
     )
  diracUtxo: DiracUtxo (
     +  dirac: Dirac(
   +     +  owner: 5d6ca14f1619efa1cdde42ac0a61344102d0edd4d71d3cf1ad155c90,
   +     +  threadNFT: IdNFT (Currency(49a0b0e032416036152977ff1fac1aed683512166af02b36f2eb1851), Hash: 16076bd0c3eb6965cf804ca73b829f24d0e75ed838240badfa6701bfa71391d5),
   +     +  paramNFT: IdNFT (Currency(49a0b0e032416036152977ff1fac1aed683512166af02b36f2eb1851), Hash: e902fc7f46f22bf3e75dabc8b0c90e70efd98ae1c5d203a15b7207ab35d7dcfa),
   +     +  anchorPrices: +[
   +     +  +  8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e_PnzWVC: 100,
   +     +  +  10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab_DsDUu: 8892
   +     +  ],
   +     ),
     +  balance: +[
   +  +  _: 2629100,
   +  +  10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab_DsDUu: 9000,
   +  +  8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e_PnzWVC: 4165
   +  ]
     )
  boughtAsset:  Asset(10382359558c90dcaeb7b734d8f5d8845317862de98a8389ade057ab, DsDUu)
  soldAsset:    Asset(8d67a81360902e21c73fec46cc080ea5800bee49d5d4c16f00d65f2e, PnzWVC)
  boughtAmount: 3
  soldAmount:   41
  boughtSpot:   17810
  soldSpot:     214673
  (boughtA0:    644019)
  (soldA0:      730210)
  boughtExp:    58
  soldExp:      771
  spotPrice:    12.05350926445817
  eff.Price:    13.666666666666666
  maxBuying:    9000
  (maxBuyingA0: 1932057000)
)
    throw new AssertionError(msg);
[0m[31m          ^[0m
    at [0m[1m[3massert[0m ([0m[36mhttps://deno.land/std@0.167.0/testing/asserts.ts[0m:[0m[33m141[0m:[0m[33m11[0m)
    at [0m[1m[3mSwapping.testSellTooLittle[0m ([0m[36mfile:///Users/ChrisHiatt/Projects/adaswap/vasil_2022Q3/euclid-offchain/src/chain/actions/swapping.ts[0m:[0m[33m564[0m:[0m[33m5[0m)
    at [0m[1m[3mSwapping.corruptionTests[0m ([0m[36mfile:///Users/ChrisHiatt/Projects/adaswap/vasil_2022Q3/euclid-offchain/src/chain/actions/swapping.ts[0m:[0m[33m515[0m:[0m[33m14[0m)
    at new [0m[1m[3mSwapping[0m ([0m[36mfile:///Users/ChrisHiatt/Projects/adaswap/vasil_2022Q3/euclid-offchain/src/chain/actions/swapping.ts[0m:[0m[33m56[0m:[0m[33m36[0m)
    at [0m[1m[3mFunction.boundary[0m ([0m[36mfile:///Users/ChrisHiatt/Projects/adaswap/vasil_2022Q3/euclid-offchain/src/chain/actions/swapping.ts[0m:[0m[33m303[0m:[0m[33m12[0m)
    at [0m[36mfile:///Users/ChrisHiatt/Projects/adaswap/vasil_2022Q3/euclid-offchain/src/chain/utxo.ts[0m:[0m[33m443[0m:[0m[33m35[0m
    at [0m[1m[3mArray.forEach[0m ([0m[36m<anonymous>[0m)
    at [0m[36mfile:///Users/ChrisHiatt/Projects/adaswap/vasil_2022Q3/euclid-offchain/src/chain/utxo.ts[0m:[0m[33m338[0m:[0m[33m21[0m
    at [0m[1m[3mArray.forEach[0m ([0m[36m<anonymous>[0m)
    at [0m[1m[3mDiracUtxo.swappingsFor[0m ([0m[36mfile:///Users/ChrisHiatt/Projects/adaswap/vasil_2022Q3/euclid-offchain/src/chain/utxo.ts[0m:[0m[33m333[0m:[0m[33m20[0m)

[0m[1m[37m[41m FAILURES [0m

emulator [0m[38;5;245m=> ./tests/emulator.test.ts:15:6[0m

[0m[31mFAILED[0m | 0 passed | 1 failed [0m[38;5;245m(30s)[0m

[0m[1m[31merror[0m: Test failed
